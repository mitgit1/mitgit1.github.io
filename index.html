<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- Все метатеги и стили остаются без изменений -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M5 Недо-хакер</title>
    <style>
        /* Все стили остаются без изменений */
        /* ... */
    </style>
</head>
<body>
    <!-- HTML-структура остается без изменений -->
    <div class="modal-overlay mobile-warning" id="mobile-warning">
        <!-- ... -->
    </div>

    <canvas id="matrix-canvas"></canvas>
    <!-- ... -->

    <script>
        // Добавляем глобальные переменныe для управления анимациями
        let matrixInterval;
        let isBootStarted = false;

        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        function showMobileWarning() {
            const warning = document.getElementById('mobile-warning');
            const content = warning.querySelector('.modal-content');
            warning.style.display = 'flex';
            content.classList.add('modal-show');
            document.body.style.overflow = 'hidden';
        }

        function hideMobileWarning() {
            const warning = document.getElementById('mobile-warning');
            const content = warning.querySelector('.modal-content');
            content.classList.add('modal-hide');
            setTimeout(() => {
                warning.style.display = 'none';
                document.body.style.overflow = '';
                document.querySelectorAll('.mobile-hidden').forEach(el => {
                    el.style.display = '';
                });

                // Сбрасываем состояние загрузочного экрана
                const bootContainer = document.querySelector('.boot-container');
                const bootSequence = document.getElementById('boot-sequence');
                bootContainer.style.maxWidth = '600px';
                bootContainer.style.height = 'auto';
                bootSequence.innerHTML = '';
                bootSequence.style.display = 'block';

                // Удаляем ранее добавленный контент
                const addedContent = bootContainer.querySelector('div:not(#boot-sequence)');
                if (addedContent) addedContent.remove();

                // Переинициализируем матрицу
                clearInterval(matrixInterval);
                resizeCanvas();
                matrixInterval = setInterval(drawMatrix, 50);

                // Запускаем процесс загрузки если еще не запущен
                if (!isBootStarted) {
                    startBootSequence();
                    isBootStarted = true;
                }
            }, 500);
        }

        document.addEventListener('DOMContentLoaded', () => {
            if(isMobileDevice()) {
                showMobileWarning();
                document.getElementById('continue-btn').addEventListener('click', hideMobileWarning);
                // Не запускаем начальную загрузку на мобильных
                isBootStarted = false;
            } else {
                document.querySelectorAll('.mobile-hidden').forEach(el => {
                    el.style.display = '';
                });
                // Запускаем обычную инициализацию
                startBootSequence();
            }
        });

        // Остальные функции без изменений
        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        const chars = '01ABCDEFGHIJKLMNOPQRSTUVWXYZ$%^&*ｱｲｳｴｵｶｷｸｹｺｻｼｽｾｿﾀﾁﾂﾃﾄ';
        const drops = new Array(Math.floor(canvas.width/20)).fill(0);

        function drawMatrix() {
            ctx.fillStyle = 'rgba(0, 17, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#00ff80';
            ctx.font = '20px "MS Gothic", monospace';

            drops.forEach((drop, i) => {
                const char = chars[Math.floor(Math.random() * chars.length)];
                ctx.fillText(char, i * 20, drop * 20);
                if(drop * 20 > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            });
        }

        const bootSteps = [
            "Инициализация ядра...",
            "Загрузка модулей...",
            "Подключение к Matrix...",
            "Активация протоколов..."
        ];

        async function startBootSequence() {
            isBootStarted = true;
            const container = document.getElementById('boot-sequence');
            const bootContainer = document.querySelector('.boot-container');
            const actionBtns = document.querySelectorAll('.action-btn');

            for (const step of bootSteps) {
                const line = document.createElement('div');
                line.className = 'boot-line';
                line.innerHTML = `
                    <div class="spinner"></div>
                    <div class="boot-text">${step}</div>
                `;
                container.appendChild(line);
                await new Promise(resolve => setTimeout(resolve, 2000));
                line.innerHTML = `
                    <div class="boot-text">
                        ${step} <span class="completed">✔ Готово</span>
                    </div>
                `;
            }

            setTimeout(() => {
                bootContainer.style.maxWidth = '90vw';
                bootContainer.style.height = '70vh';
                container.style.display = 'none';
                const content = `
                    <div style="padding: 2rem; text-align: center;">
                        <h2>Обо мне</h2>
                        <p style="margin-top: 1rem;">
                            Привет! Я не хакер.<br>
                            Просто люблю технологии, игры<br>
                            и эксперименты с электроникой
                        </p>
                        <canvas id="oscilloscope"></canvas>
                    </div>
                `;
                bootContainer.insertAdjacentHTML('beforeend', content);
                actionBtns.forEach(btn => btn.classList.add('visible'));
                initOscilloscope();
            }, 1000);
        }

        // Остальные функции без изменений
        function initOscilloscope() { /* ... */ }
        document.querySelectorAll('button').forEach(btn => { /* ... */ });
        function showModal(type) { /* ... */ }
        function closeModal(modal) { /* ... */ }

        // Инициализация матрицы через управляемую переменную
        matrixInterval = setInterval(drawMatrix, 50);
    </script>
</body>
</html>
